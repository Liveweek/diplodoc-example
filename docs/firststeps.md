# Первые шаги

## Подготовка маппинга для генерации

К сожалению, маппинги RDV от аналитика к аналитику имеют незначительные отличия, которые могут повлиять на автоматизацию процесса разработки, в результате чего нужно предварительно проверять руками содержимое файла. Для этого необходимо выполнить небольшой перечень предварительных работ.

### Название страниц файла маппинга RDV

В генераторе зашита информация, что основная часть маппинга, где располагается соответствие полей источника и RDV, должна называться **"Детали загрузок Src-RDV"**. При несоответствии этой страницы заданному названию необходимо её соответствующим образом переименовать.

### Названия колонок маппинга

Генератор опирается на названия колонок маппинга на английском языке, он их использует для выборок и фильтраций значений. В случае несоответствия колонок необходимым названиям, генератор не сможет выполнить импорт файла маппинга для последующей обработки и покажет окно с ошибкой.

![Сообщение с ошибкой](https://storage.yandexcloud.net/konakov-diplodoc-img/error_message.png =500x200)

Для того, чтобы генератор смог обработать файл, необходимо, чтобы колонки были в наличии и имели следующий формат:

| **Русское название колонки**                 | **Англ. версия колонки (2 строка маппинга)** |
| -------------------------------------------- | -------------------------------------------- |
| Версия с                                     | Mapping_ver                                  |
| Версия до                                    | Mapping_ver_to                               |
| UID алгоритма                                | Algorithm_UID                                |
| UID субалгоритма                             | SubAlgorithm_UID                             |
| Таблица источника                            | Src_table                                    |
| Атрибут источника                            | Src_attr                                     |
| Тип данных атрибута источника                | Src_attr_datatype                            |
| PK источника                                 | Src_PK                                       |
| Выражение                                    | Expression                                   |
| Таблица приёмника                            | Tgt_table                                    |
| PK приемника                                 | Tgt_PK                                       |
| Атрибут приемника                            | Tgt_attribute                                |
| Тип данных атрибута приемника                | Tgt_attr_datatype                            |
| Обязательность заполнения атрибута приемника | Tgt_attr_mandatory                           |
| Способ перекодировки                         | Attr:Conversion_type                         |
| Схема БК                                     | Attr:BK_Schema                               |
| Основной объект                              | Attr:BK_Object                               |
| Замена null для hub/ref                      | Attr:nulldefault                             |

При необходимости, все эти колонки необходимо проверить и привести в соответствие с таблицей **(именно те, которые на английском языке)**.

## Использование генератора

Генератор может работать как через командную строку посредством задания параметров запуска скрипта, так и через графический интерфейс. Для запуска генератора используется файл main.py со следующими параметрами:

`--ui` – Включение генератора через графический интерфейс. При использовании данного параметра, откроется окно программы.

`--src_cd <код_источника>` – Придуманный код источника, который используется для того, чтобы создать уникальную папку этим кодом источника (зависимости от СУБО и выбранного кода нет, просто выберите тот, с помощью которого можно будет найти результат работы генератора на текущем запуске)

`--path <полный_путь_к_маппингу>`– Указывается полный путь к файлу маппинга, который необходимо обработать. Для передачи его в качестве аргумента командной строки рекомендую использовать двойные кавычки.

`--load <режим_загрузки>` – Выбор режима загрузки, который будет осуществляться при работе потока (increment или snapshot)

`--sys <система>` – Выбор системы источника для потока. В данном случае необходимо указать, что является источником данных для данного потока (DAPP или DRP, указывать заглавными буквами).

{% note warning %}

При выборе системы источника стоит учитывать именно первоисточник загрузки данных. То есть, если изначально СУБО грузилось в DRP, а в DAPP было перенесенотолько в рамках миграции, то в качестве параметра генератора стоит указать всё равно DRP.

{% endnote %}

Типичный пример запуска генератора через скрипт:
```bash
py main.py --src_cd 1785 --path "C:\Users\user\Documents\Mapping_file_BOOP.xlsx" --load increment
```

Запуск генератора через графический интерфейс:
```bash
py main.py --ui
```

## Работа с графическим интерфейсом

Тут всё просто, буквально все поля ввода дублируют описанные ранее параметры для командной строки за исключением того, что через диалоговое окно, как мне кажется, выбирать файл маппинга проще.

![main_window](https://storage.yandexcloud.net/konakov-diplodoc-img/main_window.png =380x500)

Последовательность действий такая:

1. Выбрать файл маппинга через диалоговое окно, которое вызывается через кнопку **"Выбрать файл..."**
2. Ввести код источника (который нужен для обозначения папки результата работы генератора)
3. Выбрать систему источника (DAPP или DRP на данный момент)
4. Выбрать принцип загрузки данных в рамках потока (increment или snapshot)
5. Нажать на кнопку **"ЭКСПОРТИРОВАТЬ"**

Если все шаги выполнены, то после успешного выполнения процесса генерации будет выведено сообщение.

![success](https://storage.yandexcloud.net/konakov-diplodoc-img/success_message.png =450x200)

Папка с кодом источника в качестве названия будет с формирован в папке генератора, где будут лежать все файлы yaml (источник, приемник, CF, WF, DDL Марта, ресурс марта).